# Test VRL for JSON log
# JSON Handler - Always included for JSON logs
if exists(.message) && is_json(string!(.message)) {
    .event.original = del(.message)
    parsed, err = parse_json(string!(.event.original))
    if err == null {
        .event_data = object!(parsed)
    }
} else if is_string(.message) {
    .event.original = del(.message)
    .event_data = .event.original
} else if !exists(.message) {
    parsed = object(.); del(.); .event = {}
    .event.original = encode_json(parsed)
    .event_data = parsed
}

# Initialize event_data if not exists
if !exists(.event_data) {
    .event_data = {}
}
